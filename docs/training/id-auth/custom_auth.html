<!DOCTYPE html>

































































<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico" />
<title>Creating a Custom Account Type | Android Developers</title>
<link href="../../assets/android-developer-docs-devguide.css" rel="stylesheet" type="text/css" />
<script src="../../assets/search_autocomplete.js" type="text/javascript"></script>
<script src="../../assets/jquery-resizable.min.js" type="text/javascript"></script>
<script src="../../assets/android-developer-docs.js" type="text/javascript"></script>
<script src="../../assets/prettify.js" type="text/javascript"></script>
<script type="text/javascript">
  setToRoot("../../");
</script>
<script src="../../resources/resources-data.js" type="text/javascript"></script>
<noscript>
  <style type="text/css">
    html,body{overflow:auto;}
    #body-content{position:relative; top:0;}
    #doc-content{overflow:visible;border-left:3px solid #666;}
    #side-nav{padding:0;}
    #side-nav .toggle-list ul {display:block;}
    #resize-packages-nav{border-bottom:3px solid #666;}
  </style>
</noscript>
</head>
<body class="gc-documentation">

  <div id="header">
      <div id="headerLeft">
          <a href="../../index.html" tabindex="-1"><img
              src="../../assets/images/bg_logo.png" alt="Android Developers" /></a>
          <ul id="header-tabs" class="resources">
    
	<li id="home-link"><a href="../../offline.html">
	
		<span class="en">Home</span>
		<span style="display:none" class="de">Startseite</span>
		<span style="display:none" class="es"></span>
		<span style="display:none" class="fr"></span>
		<span style="display:none" class="it"></span>
		<span style="display:none" class="ja">ホーム</span>
		<span style="display:none" class="zh-CN">主页</span>
		<span style="display:none" class="zh-TW">首頁</span>
	
	</a></li>
	<li id="sdk-link"><a href="../../sdk/index.html">
		<span class="en">SDK</span>
	</a></li>
	<li id="guide-link"><a href="../../guide/index.html" onClick="return loadLast('guide')">
	
		<span class="en">Dev Guide</span>
		<span style="display:none" class="de">Handbuch</span>
		<span style="display:none" class="es">Guía</span>
		<span style="display:none" class="fr">Guide</span>
		<span style="display:none" class="it">Guida</span>
		<span style="display:none" class="ja">開発ガイド</span>
		<span style="display:none" class="zh-CN">开发人员指南</span>
		<span style="display:none" class="zh-TW">開發指南</span>
	
	</a></li>
	<li id="reference-link"><a href="../../reference/packages.html" onClick="return loadLast('reference')">
	
		<span class="en">Reference</span>
		<span style="display:none" class="de">Referenz</span>
		<span style="display:none" class="es">Referencia</span>
		<span style="display:none" class="fr">Référence</span>
		<span style="display:none" class="it">Riferimento</span>
		<span style="display:none" class="ja">リファレンス</span>
		<span style="display:none" class="zh-CN">参考</span>
		<span style="display:none" class="zh-TW">參考資料</span>
	
	</a></li>
	<li id="resources-link"><a href="../../resources/index.html" onClick="return loadLast('resources')">
	
		<span class="en">Resources</span>
		<span style="display:none" class="de"></span>
		<span style="display:none" class="es"></span>
		<span style="display:none" class="fr"></span>
		<span style="display:none" class="it"></span>
    		<span style="display:none" class="ja"></span>
		<span style="display:none" class="zh-CN"></span>
		<span style="display:none" class="zh-TW"></span>
	
	</a></li>
	<li id="videos-link"><a href="../../videos/index.html" onClick="return loadLast('videos')">
	
		<span class="en">Videos</span>
		<span style="display:none" class="de"></span>
		<span style="display:none" class="es"></span>
		<span style="display:none" class="fr"></span>
		<span style="display:none" class="it"></span>
		<span style="display:none" class="ja">ビデオ</span>
		<span style="display:none" class="zh-CN"></span>
		<span style="display:none" class="zh-TW"></span>
	
	</a></li>
	<li><a href="http://android-developers.blogspot.com" onClick="return requestAppendHL(this.href)">
	
		<span class="en">Blog</span>
		<span style="display:none" class="de"></span>
		<span style="display:none" class="es"></span>
		<span style="display:none" class="fr"></span>
		<span style="display:none" class="it"></span>
		<span style="display:none" class="ja">ブログ</span>
		<span style="display:none" class="zh-CN">博客</span>
		<span style="display:none" class="zh-TW">網誌</span>
	
	</a></li>


     
</ul>
     
      </div>
      <div id="headerRight">
          <div id="headerLinks">
          
          <a href="http://www.android.com">Android.com</a>
          </div>
  <div id="search" >
      <div id="searchForm">
          <form accept-charset="utf-8" class="gsc-search-box" 
                onsubmit="return submit_search()">
            <table class="gsc-search-box" cellpadding="0" cellspacing="0"><tbody>
                <tr>
                  <td class="gsc-input">
                    <input id="search_autocomplete" class="gsc-input" type="text" size="33" autocomplete="off"
                      title="search developer docs" name="q"
                      value="search developer docs"
                      onFocus="search_focus_changed(this, true)"
                      onBlur="search_focus_changed(this, false)"
                      onkeydown="return search_changed(event, true, '../../')"
                      onkeyup="return search_changed(event, false, '../../')" />
                  <div id="search_filtered_div" class="no-display">
                      <table id="search_filtered" cellspacing=0>
                      </table>
                  </div>
                  </td>
                  <td class="gsc-search-button">
                    <input type="submit" value="Search" title="search" id="search-button" class="gsc-search-button" />
                  </td>
                  <td class="gsc-clear-button">
                    <div title="clear results" class="gsc-clear-button">&nbsp;</div>
                  </td>
                </tr></tbody>
              </table>
          </form>
      </div><!-- searchForm -->
  </div><!-- search -->
      </div><!-- headerRight -->
      <script type="text/javascript">
        <!--  
        changeTabLang(getLangPref());
        //-->
      </script>
  </div><!-- header -->

  <div class="g-section g-tpl-200" id="body-content">
    <div class="g-unit g-first" id="side-nav">
      <div id="devdoc-nav"><ul>
  <li>
    <h2><span class="en">Technical Resources</span>
    </h2>
    <ul>
      <li class="toggle-list">
        <div><a href="../../resources/browser.html?tag=sample">
            <span class="en">Sample Code</span>
            <span class="de" style="display:none">Beispielcode</span>
            <span class="es" style="display:none">Código de ejemplo</span>
            <span class="fr" style="display:none">Exemple de code</span>
            <span class="it" style="display:none">Codice di esempio</span>
            <span class="ja" style="display:none">サンプル コード</span>
            <span class="zh-CN" style="display:none"></span>
            <span class="zh-TW" style="display:none"></span>
          </a></div>
        <ul id="devdoc-nav-sample-list">
          <li><a href="../../resources/samples/get.html">
                <span class="en">Getting the Samples</span>
              </a></li>
        </ul>
      </li>
      <li class="toggle-list">
        <div><a href="../../resources/browser.html?tag=article">
               <span class="en">Articles</span>
             </a></div>
        <ul id="devdoc-nav-article-list">
        </ul>
      </li>
      <li class="toggle-list">
        <div><a href="../../resources/browser.html?tag=tutorial">
               <span class="en">Tutorials</span>
               <span class="de" style="display:none">Lernprogramme</span>
               <span class="es" style="display:none">Tutoriales</span>
               <span class="fr" style="display:none">Didacticiels</span>
               <span class="it" style="display:none">Esercitazioni</span>
               <span class="ja" style="display:none">チュートリアル</span>
               <span class="zh-CN" style="display:none"></span>
               <span class="zh-TW" style="display:none"></span>
             </a></div>
        <ul id="devdoc-nav-tutorial-list">
        </ul>
      </li>
      <li class="toggle-list">
        <div><a href="../../resources/topics.html">
               <span class="en">Topics</span>
             </a></div>
        <ul id="devdoc-nav-topic-list">
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <h2><span class="en">Community</span>
               <span style="display:none" class="de"></span>
               <span style="display:none" class="es">Comunidad</span>
               <span style="display:none" class="fr">Communauté</span>
               <span style="display:none" class="it"></span>
               <span style="display:none" class="ja">コミュニティ</span>
               <span style="display:none" class="zh-CN">社区</span>
               <span style="display:none" class="zh-TW">社群</span>
    </h2>
    <ul>
      <li><a href="../../resources/community-groups.html">
            <span class="en">Developer Forums</span>
          </a></li>
      <li><a href="../../resources/community-more.html">
            <span class="en">IRC, Twitter</span>
          </a></li>
    </ul>
  </li>


  <li>
   <h2><span class="en">More</span></h2>
    <ul>
      <li><a href="../../resources/faq/commontasks.html">
            <span class="en">Common Tasks </span>
          </a></li>
      <li><a href="../../resources/faq/troubleshooting.html">
            <span class="en">Troubleshooting Tips</span>
          </a></li>
      <li class="toggle-list">
        <div><a href="../../resources/faq/index.html">
               <span class="en">FAQs</span>
             </a></div>
        <ul>
        <li><a href="../../resources/faq/framework.html">
                <span class="en">App Framework FAQ</span>
                </a></li>
        <li><a href="../../resources/faq/licensingandoss.html">
                <span class="en">Licensing FAQ</span>
                </a></li>
        <li><a href="../../resources/faq/security.html">
                <span class="en">Security FAQ</span>
                </a></li>
        </ul>
     </li>
    </ul>
  </li>
</ul>

<script type="text/javascript">
<!--
    buildToggleLists();
    changeNavLang(getLangPref());
//-->
</script>

      </div>
    </div> <!-- end side-nav -->
    <script>
      addLoadEvent(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>




<div class="g-unit" id="doc-content"><a name="top"></a>

<div id="jd-header" class="guide-header">
  <span class="crumb">
    
      <a href="index.html">Identifying and Authenticating Users</a>:
    
  </span>
<h1>Creating a Custom Account Type</h1>
</div>

  
  <div id="jd-content">
 
    
    <div class="training-nav-top">

      

      
      <div class="training-nav-button-previous">
        <a href="authenticate.html">
          <span style="font-size:1.2em">&lsaquo;</span>
          Previous lesson
          <span class="training-nav-button-title">Authenticating to OAuth2 Services</span>
        </a>
      </div>

      

    </div><!-- end training-nav-top -->
    


    <div class="jd-descr">
    <div id="tb-wrapper">
  <div id="tb">
<h2>This lesson teaches you to</h2>
<ol>
  <li><a href="#AccountCode">Implement Your Custom Account Code</a></li>
  <li><a href="#Security">Be Smart About Security!</a></li>
  <li><a href="#ExtendThatThing">Extend AbstractAccountAuthenticator</a></li>
  <li><a href="#TaskFour">Create an Authenticator Service</a></li>
  <li><a href="#DistributeService">Distribute Your Service</a></li>
</ol>

<h2>You should also read</h2>
<ul>
  <li><a
href="http://developer.android.com/resources/samples/SampleSyncAdapter/index.html">
SampleSyncAdapter app</a></li>
</ul>
  </div>
</div>

<p>In the previous lessons, we've talked about using Google accounts to identify Google users and
access Google APIs. But what if you've got your own online service? It turns out
to be relatively straightforward to install new account types on a user's
device. This lesson explains how to create a custom account type that works the
same way as the built-in accounts do. </p>


<h2 id="AccountCode">Implement Your Custom Account Code</h2>

<p>The first thing you'll need is a way to get credentials from the user. This
may be as simple as a dialog box that asks for a name and a password. Or it may
be a more exotic procedure like a one-time password or a biometric scan. Either
way, it's your responsibility to implement the code that:</p>
<ol>
  <li>Collects credentials from the user</li>
  <li>Authenticates the credentials with the server</li>
  <li>Stores the credentials on the device</li>
</ol>


<p>Typically all three of these requirements can be handled by one activity. We'll call this the
authenticator activity.</p>

<p>Because they need to interact with the <code><a href="../../reference/android/accounts/AccountManager.html">AccountManager</a></code> system,
authenticator activities have certain requirements that normal activities don't. To make it easy to
get things right, the Android framework supplies a base class, <code><a href="../../reference/android/accounts/AccountAuthenticatorActivity.html">AccountAuthenticatorActivity</a></code>, which you can extend to create your own custom
authenticator.</p>

<p>How you address the first two requirements of an authenticator activity,
credential collection and authentication, is completely up to you. (If there
were only one way to do it, there'd be no need for "custom" account types, after
all.) The third requirement has a canonical, and rather simple,
implementation:</p>

<pre>
final Account account = new Account(mUsername, <em>your_account_type</em>);
mAccountManager.addAccountExplicitly(account, mPassword, null);
</pre>


<h2 id="Security">Be Smart About Security!</h2>

<p>It's important to understand that <code><a href="../../reference/android/accounts/AccountManager.html">AccountManager</a></code> is not an encryption
service
or a keychain. It stores account credentials just as you pass them, in <strong>plain
text</strong>. On most devices, this isn't
a particular concern, because it stores them in
a database that is only accessible to root. But on a rooted device, the
credentials would be readable by anyone with <code>adb</code> access to the device.</p>

<p>With this in mind, you shouldn't pass the user's actual
password to <code><a href="../../reference/android/accounts/AccountManager.html#addAccountExplicitly(android.accounts.Account, java.lang.String, android.os.Bundle)">AccountManager.addAccountExplicitly()</a></code>. Instead, you should store a
cryptographically secure token that would be of limited use to an attacker. If your
user credentials are protecting something valuable, you should carefully
consider doing something similar.</p>

<p class="caution"><strong>Remember:</strong> When it comes to security code, follow the
"Mythbusters" rule: don't try this at home! Consult a security professional before implementing any
custom account code.</p>

<p>Now that the security disclaimers are out of the way, it's time to get back to work.
You've already implemented the meat of your custom account code; what's left is
plumbing.</p>


<h2 id="ExtendThatThing">Extend AbstractAccountAuthenticator</h2>

<p>In order for the <code><a href="../../reference/android/accounts/AccountManager.html">AccountManager</a></code> to work with your custom account
code, you
need a class that implements the interfaces that <code><a href="../../reference/android/accounts/AccountManager.html">AccountManager</a></code> expects.
This class is the <em>authenticator class</em>.</p>

<p>The easiest way to create an authenticator class is to extend
<code><a href="../../reference/android/accounts/AbstractAccountAuthenticator.html">AbstractAccountAuthenticator</a></code> and implement its abstract methods. If you've
worked through the previous lessons, the abstract methods of
<code><a href="../../reference/android/accounts/AbstractAccountAuthenticator.html">AbstractAccountAuthenticator</a></code> should look familiar: they're the opposite
side of
the methods you called in the previous lesson to get account information and
authorization tokens.</p>

<p>Implementing an authenticator class properly requires a number of separate
pieces of code. First, <code><a href="../../reference/android/accounts/AbstractAccountAuthenticator.html">AbstractAccountAuthenticator</a></code> has seven abstract
methods that you must override. Second, you need to add an
<a href="../../guide/topics/manifest/intent-filter-element.html">intent filter</a> for
<code>"android.accounts.AccountAuthenticator"</code> to your application
manifest (shown in the next section). Finally, you must supply two XML resources that define, among
other
things, the name of your custom account type and the icon that the system will
display next to accounts of this type.</p>

<p> You can find a step-by-step guide to implementing a successful authenticator class and the XML
files in the <code><a href="../../reference/android/accounts/AbstractAccountAuthenticator.html">AbstractAccountAuthenticator</a></code> documentation. There's also a
sample implementation in the <a
href="http://developer.android.com/resources/samples/SampleSyncAdapter/index.html">
SampleSyncAdapter sample app</a>.</p>

<p>As you read through the SampleSyncAdapter code, you'll notice that several of
the methods return an intent in a bundle. This is the same intent that will be
used to launch your custom authenticator activity. If your authenticator
activity needs any special initialization parameters, you can attach them to the
intent using <code><a href="../../reference/android/content/Intent.html#putExtra(java.lang.String, android.os.Bundle)">Intent.putExtra()</a></code>.</p>


<h2 id="TaskFour">Create an Authenticator Service</h2>

<p>Now that you have an authenticator class, you need a place for it to live.
Account authenticators need to be available to multiple applications and work in
the background, so naturally they're required to run inside a <code><a href="../../reference/android/app/Service.html">Service</a></code>. We'll
call this the authenticator service.</p>

<p>Your authenticator service can be very simple. All it needs to do is create
an instance of your authenticator class in <code><a href="../../reference/android/app/Service.html#onCreate()">onCreate()</a></code> and call
<code><a href="../../reference/android/accounts/AbstractAccountAuthenticator.html#getIBinder()">getIBinder()</a></code> in <code><a href="../../reference/android/app/Service.html#onBind(android.content.Intent)">onBind()</a></code>. The <a
href="http://developer.android.com/resources/samples/SampleSyncAdapter/index.html">
SampleSyncAdapter</a> contains a good example of an authenticator service.</p>

<p>Don't forget to add a <code>&lt;service&gt;</code> tag to your manifest file
and add an intent filter for the AccountAuthenticator intent and declare the account
authenticator:</p>

<pre>
&lt;service ...>
   &lt;intent-filter>
      &lt;action android:name="android.accounts.AccountAuthenticator" />
   &lt;/intent-filter>
   &lt;meta-data android:name="android.accounts.AccountAuthenticator"
             android:resource="@xml/authenticator" />
&lt;/service>
</pre>


<h2 id="DistributeService">Distribute Your Service</h2>

<p>You're done! The system now recognizes your account type, right alongside all
the big name account types like "Google" and "Corporate." You can use the
<strong>Accounts &amp; Sync</strong> Settings page to add an account, and apps that ask for
accounts of your custom type will be able to enumerate and authenticate just as
they would with any other account type.</p>

<p>Of course, all of this assumes that your account service is actually
installed on the device. If only one app will ever access the service, then
this isn't a big deal&mdash;just bundle the service in the app.
But if you want your account service to be used by more than one app, things get
trickier. You don't want to bundle the service with all of your apps and have
multiple copies of it taking up space on your user's device.</p>

<p>One solution is to place the service in one small, special-purpose APK. When
an app wishes to use your custom account type, it can check the device to see if
your custom account service is available. If not, it can direct the user to
Android Market to download the service. This may seem like a great deal of
trouble at first, but compared with the alternative of re-entering credentials
for every app that uses your custom account, it's refreshingly easy.</p>

    </div>

    
    <div class="training-nav-bottom">
      

      
      <div class="training-nav-button-previous">
        <a href="authenticate.html">
          <span style="font-size:1.2em">&lsaquo;</span>
          Previous lesson
          <br/><span class="training-nav-button-title">Authenticating to OAuth2 Services</span>
        </a>
      </div>
      
    </div> <!-- end training-nav -->
    
    
    <a href="#top" style="float:right">&uarr; Go to top</a>
    
      <p><a href="index.html">&larr; Back to Identifying and Authenticating Users</a></p>
    

  </div> <!-- end jd-content -->

<div id="footer">


  <div id="copyright">
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="../../license.html">Content 
  License</a>.
  </div>

  <div id="footerlinks">
    
  <p>
    <a href="http://www.android.com/terms.html">Site Terms of Service</a> -
    <a href="http://www.android.com/privacy.html">Privacy Policy</a> -
    <a href="http://www.android.com/branding.html">Brand Guidelines</a>
  </p>
  </div>

</div> <!-- end footer -->

</div><!-- end doc-content -->

</div> <!-- end body-content --> 

<script type="text/javascript">
init(); /* initialize android-developer-docs.js */
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5831155-1");
pageTracker._trackPageview();
</script>

</body>
</html>



